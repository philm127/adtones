@using System.Web.Optimization
@using EFMVC.Web.Areas.Users.SearchClass;
@using EFMVC.Web.ViewModels;
@model Tuple<IEnumerable<UserProfileAdvertsReceivedFromModel>, AccountOverviewFilter>
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Users/Views/Shared/_Layout.cshtml";
}

<div class="wrapper wrapper-content animated fadeIn">
    <div class="spiner-example" style="display:none;">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
    <div class="p-w-md m-t-sm">
        <div class="row">
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        @*<h5>Overall Total Credit</h5>*@
                        <h5>Overall Total Credit Received</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins" style="color:#1e90ff;">@ViewBag.TotalCredit</h1>
                        <small>Total Credit in overall period</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        @*<h5>Monthly Total Credit</h5>*@
                        <h5>Month's Total Credit Received</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins" style="color:#1e90ff;">@ViewBag.MonthlyCredit</h1>
                        <small>Total Credit in current month period</small>
                    </div>
                </div>
            </div>

            @*Commented 22-02-2019*@
            @*<div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">

                            <h5>Weekly Total Credit</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" style="color:#1e90ff;">@ViewBag.WeeklyCredit</h1>

                            <small>Total Credit in current week period</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Today's Total Credit</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" style="color:#1e90ff;">@ViewBag.TodayCredit</h1>
                            <small>Total Credit in today's period</small>
                        </div>
                    </div>
                </div>*@

            @*Add 22-02-2019*@
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        @*<h5>Rewards (@ViewBag.currencyCode)</h5>*@
                        <h5>Rewards Redeemed</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins" style="color:#1e90ff;">@ViewBag.TotalRewards</h1>
                        <small>Total Rewards in overall period</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Unused Credit</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins" style="color:#1e90ff;">@ViewBag.UnusedCredit</h1>
                        <small>The remaining credits in the pot</small>
                    </div>
                </div>
            </div>

            @*Commented on 18-02-2019*@
            @*Add 15-02-2019*@
            @*<div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Rewards</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" style="color:#1e90ff;">1</h1>
                            <small>Total Rewards Earned</small>
                        </div>
                    </div>
                </div>*@

        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-content">
                        @Html.Partial("_AccountOverviewManagement", Tuple.Create<IEnumerable<UserProfileAdvertsReceivedFromModel>, AccountOverviewFilter>(Model.Item1, Model.Item2))
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@Styles.Render("~/plugins/awesomeCheckboxStyles")
@Styles.Render("~/plugins/clockpickerStyles")
@*@Styles.Render("~/plugins/dateRangeStyles")*@
@Styles.Render("~/Content/plugins/iCheck/custom")
@Styles.Render("~/Content/plugins/chosen/chosenStyles")
@Styles.Render("~/plugins/switcheryStyles")
@Styles.Render("~/plugins/jasnyBootstrapStyles")
@Styles.Render("~/plugins/nouiSliderStyles")
@*@Styles.Render("~/plugins/dataPickerStyles")*@
@Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
@Styles.Render("~/plugins/imagecropperStyles")
@Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
@Styles.Render("~/plugins/select2Styles")
@Styles.Render("~/plugins/touchSpinStyles")
@Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
@Styles.Render("~/plugins/daterangepickerNewStylesforusers")

@section Scripts {
    @Scripts.Render("~/plugins/sparkLine")
    @Scripts.Render("~/plugins/flot")
    @Scripts.Render("~/plugins/iCheck")
    @*@Scripts.Render("~/plugins/dataPicker")*@
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @*@Scripts.Render("~/plugins/dateRange")*@
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/jeditable")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/daterangepickerNew")

    <script type="text/javascript">


        jQuery(document).ready(function ($) {
            $('body').bind('keyup', function (event) {
                if (event.keyCode === 13) {
                    $('#form0').submit();
                }
            });
            $(".chosen-container").bind('keyup', function (e) {
                if (e.which === 13) {
                    $('#form0').submit();
                    // or your stuff here...
                }
            });
            $('#createdFrom').datetimepicker({ ignoreReadonly: true });

            $('#createdTo').datetimepicker({
                useCurrent: false, //Important! See issue #1075
                ignoreReadonly: true
            });

            $("#createdFrom").on("dp.change", function (e) {
                $('#createdTo').data("DateTimePicker").minDate(e.date);
            });

            $("#createdTo").on("dp.change", function (e) {
                $('#createdFrom').data("DateTimePicker").maxDate(e.date);
            });
            $('#fromdate').css({ "height": "34px" });
            $('#todate').css({ "height": "34px" });
            var login = '@ViewBag.FromLogin';
            if (login == "True")
            {
                if (window.history && window.history.pushState) {

                    //window.history.pushState('forward', null, './#forward');
                    window.history.pushState('index', null, './Index');

                    $(window).on('popstate', function () {
                        //alert('Back button was pressed.');
                        window.location.href = "/Users/Account/LogOff";
                    });

                }
            }

            $("#Item2_FromCreditReceived").keypress(function (event) {
                return isNumber(event, this)
            });

            $("#Item2_ToCreditReceived").keypress(function (event) {
                return isNumber(event, this)
            });
        });


        function dataTableSetup() {
            $('.dataTables-accountOverview').DataTable({
                "preDrawCallback": function (settings) {
                    $(".spiner-example").show();
                },
                "aaSorting": [],
                "info": false,
                bFilter: false,
                "searching": false,
                aoColumnDefs: [
               {
                   bSortable: false,
                   aTargets: [-1]
               }
                ],
                "bLengthChange": false,
                "language": {
                    "infoEmpty": "No Record Found."
                },
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    { extend: 'copy', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },
                    { extend: 'csv', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },
                    { extend: 'excel', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },
                    { extend: 'pdf', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },

                    {
                        extend: 'print',
                        exportOptions: { columns: [0, 1, 2, 3, 4, 5] },
                        title: 'AccountOverview',
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                        }
                    }
                ],
                "drawCallback": function (settings) {
                    setTimeout(function () {
                        $(".spiner-example").hide();
                    }, 1000);
                    //$(".spiner-example").hide();
                }
            });
        }
        $(document).ready(function () {
            //$('#data_5 .input-daterange').datepicker({
            //    keyboardNavigation: false,
            //    forceParse: false,
            //    autoclose: true
            //});
            var config = {
                '.chosen-select': { width: "100%" },
                '.chosen-select-deselect': { allow_single_deselect: true },
                '.chosen-select-no-single': { disable_search_threshold: 10 },
                '.chosen-select-no-results': { no_results_text: 'Oops, nothing found!' },
                '.chosen-select-width': { width: "95%" }
            }
            for (var selector in config) {
                $(selector).chosen(config[selector]);
            }
            $("#accounto_reset").click(function () {
                $('#fromdate').val('');
                $('#todate').val('');
                $(".spiner-example").show();
                $("#Item2_AdvertRef").val('');
                $("#Item2_AdvertName").val('');
                $("#Item2_Brand").val('');
                $("#Item2_FromDateTimePlayed").val('');
                $("#Item2_ToDateTimePlayed").val('');
                $("#Item2_FromCreditReceived").val('');
                $("#Item2_ToCreditReceived").val('');
                $.ajax({
                    data: null,
                    datatype: "text/plain",
                    type: "POST",
                    url: '@Url.Action("SearchAccountOverview", "AccountOverview", new {Area="Users" })',
                    cache: false,
                    success: function (data) {
                        $(".spiner-example").hide();
                        $("#accountOverviewList").html(data);
                        dataTableSetup();
                    }
                });
            });
            $('.dataTables-accountOverview').DataTable({
                "preDrawCallback": function (settings) {
                    $(".spiner-example").show();
                },
                "aaSorting": [],
                "info": false,
                bFilter: false,
                "searching": false,
                aoColumnDefs: [
               {
                   bSortable: false,
                   aTargets: [-1]
               }
                ],
                "bLengthChange": false,
                "language": {
                    "infoEmpty": "No Record Found."
                },
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    { extend: 'copy', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },
                    { extend: 'csv', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },
                    { extend: 'excel', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },
                    { extend: 'pdf', title: 'AccountOverview', exportOptions: { columns: [0, 1, 2, 3, 4, 5] } },

                    {
                        extend: 'print',
                        exportOptions: { columns: [0, 1, 2, 3, 4, 5] },
                        title: 'AccountOverview',
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                        }
                    }
                ],
                "drawCallback": function (settings) {
                    setTimeout(function () {
                        $(".spiner-example").hide();
                    }, 1000);
                    //$(".spiner-example").hide();
                }
            });
        });

    </script>
}