@using EFMVC.Web.Areas.Admin.SearchClass;
@model PromotionalCampaignAuditMapping
@{
    ViewBag.Title = "Promotional Campaign Audit";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="wrapper wrapper-content animated fadeIn">
    <div class="spiner-example" style="display:none;">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
    <div class="col-sm-4">
        <h2>Promotional Campaign Audit</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Index", "PromotionalCampaign")">Promotional Campaign</a>
            </li>
            <li class="active">
                <strong>@ViewBag.campaignName</strong>
            </li>
        </ol>
    </div>
    <div class="row">&nbsp;</div>
    <div class="p-w-md m-t-sm">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-content">
                        @Html.Partial("_PromotionalCampaignAuditStatistics", Model)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    @Styles.Render("~/plugins/awesomeCheckboxStyles")
    @Styles.Render("~/plugins/clockpickerStyles")
    @Styles.Render("~/Content/plugins/iCheck/custom")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    @Styles.Render("~/plugins/switcheryStyles")
    @Styles.Render("~/plugins/jasnyBootstrapStyles")
    @Styles.Render("~/plugins/nouiSliderStyles")
    @Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
    @Styles.Render("~/plugins/imagecropperStyles")
    @Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
    @Styles.Render("~/plugins/select2Styles")
    @Styles.Render("~/plugins/touchSpinStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/Content/accordion")
    @Styles.Render("~/plugins/wizardStepsStyles")
    @Styles.Render("~/plugins/daterangepickerNewStyles")
}
@section Scripts {
    @Scripts.Render("~/plugins/sparkLine")
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/flot")
    @Scripts.Render("~/plugins/vectorMap")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/jeditable")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/wizardSteps")
    @Scripts.Render("~/plugins/nestable")
    @Scripts.Render("~/plugins/chartJs")
    @Scripts.Render("~/plugins/daterangepickerNew")
    <script type="text/javascript">

        function dataTableSetup() {
            $('.dataTables-promotionalCampaignAudit').DataTable({
                "preDrawCallback": function (settings) {
                    $(".spiner-example").show();
                },
                "aaSorting": [],
                "info": false,
                bFilter: false,
                "searching": false,
                "bLengthChange": false,
                "language": {
                    "infoEmpty": "No Record Found."
                },
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [

                    {
                        extend: 'copy',
                        text: 'Copy',
                        titleAttr: 'Copy',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7],
                        }

                    },

                    {
                        extend: 'excel',
                        text: 'Excel',
                        titleAttr: 'Excel',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            ccolumns: [0, 1, 2, 3, 4, 5, 6, 7],
                        }
                    },
                    {
                        extend: 'csvHtml5',
                        text: 'CSV',
                        titleAttr: 'CSV',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7],
                        }
                    },
                    {
                        extend: 'pdfHtml5',
                        text: 'PDF',
                        titleAttr: 'PDF',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7],
                        },
                    },
                    {
                        extend: 'print',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6,  7],
                        },
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                        }
                    }
                ],
                "drawCallback": function (settings) {
                    setTimeout(function () {
                        $(".spiner-example").hide();
                    }, 1000);
                    //$(".spiner-example").hide();
                },
                "fnInitComplete": function () {
                    setTimeout(function () {
                        $(".spiner-example").hide();
                    }, 1000);
                    //$(".spiner-example").hide();
                }	// Hide processingDiv when loading table is complete
            });
        }

        $(document).ready(function () {

            $('.StartDate').datetimepicker({ format: 'MM/DD/YYYY' });
            $('.EndDate').datetimepicker({ format: 'MM/DD/YYYY' });

            $('#startFrom').datetimepicker({ ignoreReadonly: true });

            $('#startTo').datetimepicker({
                useCurrent: false, //Important! See issue #1075
                ignoreReadonly: true
            });

            $("#startFrom").on("dp.change", function (e) {
                $('#startTo').data("DateTimePicker").minDate(e.date);
            });

            $("#startTo").on("dp.change", function (e) {
                $('#startFrom').data("DateTimePicker").maxDate(e.date);
            });

            // -----

            $('#endFrom').datetimepicker({ ignoreReadonly: true });

            $('#endTo').datetimepicker({
                useCurrent: false, //Important! See issue #1075
                ignoreReadonly: true
            });

            $("#endFrom").on("dp.change", function (e) {
                $('#endTo').data("DateTimePicker").minDate(e.date);
            });

            $("#endTo").on("dp.change", function (e) {
                $('#endFrom').data("DateTimePicker").maxDate(e.date);
            });

            $("#startFrom").css({ "height": "34px" });
            $("#startTo").css({ "height": "34px" });
            $("#endFrom").css({ "height": "34px" });
            $("#endTo").css({ "height": "34px" });

            var config = {
                '.chosen-select': { width: "100%" },
                '.chosen-select-deselect': { allow_single_deselect: true },
                '.chosen-select-no-single': { disable_search_threshold: 10 },
                '.chosen-select-no-results': { no_results_text: 'Oops, nothing found!' },
                '.chosen-select-width': { width: "95%" }
            }
            for (var selector in config) {
                $(selector).chosen(config[selector]);
            }

            $("#promotionalCampaignreset").click(function () {
                $(".spiner-example").show();
                $("#Item2_MSISDN").val('');
                $("#Item2_FromPlayLength").val('');
                $("#Item2_ToPlayLength").val('');
                $("#Item2_DTMFKey").val('');
                $("#startfromtime").val('');
                $("#starttotime").val('');
                $("#endfromtime").val('');
                $("#endtotime").val('');

                oTable.columns(0).search(null);
                oTable.columns(1).search(null);
                oTable.columns(2).search(null);
                oTable.columns(3).search(null);
                oTable.columns(4).search(null);

                //hit search on server
                oTable.draw();
                setTimeout(function () { $(".spiner-example").hide(); }, 4000);
            });

            loadData();

            $("#btnSearch").click(function () {
                $(".spiner-example").show();
                oTable.columns(0).search($('#Item2_MSISDN').val());
                if ($("#Item2_FromPlayLength").val() != '' && $("#Item2_ToPlayLength").val() != '') {
                    oTable.columns(1).search($("#Item2_FromPlayLength").val() + ',' + $("#Item2_ToPlayLength").val());
                }
                else {
                    oTable.columns(1).search(null);
                }
                oTable.columns(2).search($('#Item2_DTMFKey').val());
                if ($("#startfromtime").val() != '') {
                    oTable.columns(3).search($("#startfromtime").val() + ',' + $("#starttotime").val());
                }
                else {
                    oTable.columns(3).search(null);
                }
                if ($("#endfromtime").val() != '') {
                    oTable.columns(4).search($("#endfromtime").val() + ',' + $("#endtotime").val());
                }
                else {
                    oTable.columns(4).search(null);
                }

                //hit search on server
                oTable.draw();
                //$(".spiner-example").hide();
                setTimeout(function () { $(".spiner-example").hide(); }, 10000);
            });
        });

        function loadData() {
            $('.dataTables-promotionalCampaignAudit').DataTable({
                "preDrawCallback": function (settings) {
                    $(".spiner-example").show();
                },
                "aaSorting": [],
                "serverSide": true,
                "info": false,
                bFilter: true,
                "searching": true,
                "bLengthChange": false,
                "language": {
                    "infoEmpty": "No Record Found."
                },
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [

                    {
                        extend: 'copy',
                        text: 'Copy',
                        titleAttr: 'Copy',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7],
                        }

                    },

                    {
                        extend: 'excel',
                        text: 'Excel',
                        titleAttr: 'Excel',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            ccolumns: [0, 1, 2, 3, 4, 5, 6, 7],
                        }
                    },
                    {
                        extend: 'csvHtml5',
                        text: 'CSV',
                        titleAttr: 'CSV',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7],
                        }
                    },
                    {
                        extend: 'pdfHtml5',
                        text: 'PDF',
                        titleAttr: 'PDF',
                        title: 'PromotionalCampaignAuditDetails',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7],
                        },
                    },
                    {
                        extend: 'print',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7],
                        },
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                        }
                    }
                ],
                "ajax": {
                    "url": "/Admin/PromotionalCampaignAudit/LoadData",
                    "type": "POST",
                    "datatype": "json"
                },
                "aoColumns": [

                    { "data": "OperatorName", "name": "OperatorName", "bSortable": true, "autoWidth": true }, //index 0
                    { "data": "PromotionalCampaignName", "name": "PromotionalCampaignName", "bSortable": true, "autoWidth": true }, //index 1
                    { "data": "PromotionalAdvertName", "name": "PromotionalAdvertName", "bSortable": true, "autoWidth": true }, //index 2
                    { "data": "MSISDN", "name": "MSISDN", "bSortable": true, "autoWidth": true }, //index 3
                    { "data": "DisplayStartTime", "name": "DisplayStartTime", "bSortable": true, "autoWidth": true }, //index 4
                    { "data": "DisplayEndTime", "name": "DisplayEndTime", "bSortable": true, "autoWidth": true }, //index 5
                    { "data": "PlayLengthTicks", "name": "PlayLengthTicks", "bSortable": true, "autoWidth": true }, //index 6
                    { "data": "DTMFKey", "name": "DTMFKey", "bSortable": true, "autoWidth": true } //index 7
                ],
                "drawCallback": function (settings) {
                    setTimeout(function () {
                        $(".spiner-example").hide();
                    }, 1000);
                    //$(".spiner-example").hide();
                },
                "fnInitComplete": function () {
                    setTimeout(function () {
                        $(".spiner-example").hide();
                    }, 1000);
                    //$(".spiner-example").hide();
                }	// Hide processingDiv when loading table is complete
            });
            oTable = $('.dataTables-promotionalCampaignAudit').DataTable();
        }

    </script>

    <script type="text/javascript">
        var doughnutData = [
            {
                value: 250,
                color: "#1e90ff",
                highlight: "#1e90ff",

            },

            {
                value: 150,
                color: "#b5b8cf",
                highlight: "#b5b8cf",

            }
        ];
        $(document).ready(function () {
            var doughnutMaxBidData = [
                {
                    value: @ViewBag.TotalReach,
                    color: "#1e90ff",
                    highlight: "#1e90ff",
                    label: "Total Reach"
                }
            ];

            var doughnutOptions = {
                segmentShowStroke: true,
                segmentStrokeColor: "#fff",
                segmentStrokeWidth: 2,
                percentageInnerCutout: 45, // This is 0 for Pie charts
                animationSteps: 100,
                animationEasing: "easeOutBounce",
                animateRotate: true,
                animateScale: false,
                responsive: true,
            };

            var ctx = document.getElementById("doughnutMaxBid").getContext("2d");
            var myNewChart = new Chart(ctx).Doughnut(doughnutMaxBidData, {
                tooltipFontSize: 10,
                tooltipTemplate: "<%if (label){%><%=label%>: <%}%><%= value %>",
                percentageInnerCutout: 70
            });
            //var myNewChart = new Chart(ctx).Doughnut(doughnutMaxBidData, doughnutOptions);

            var barchartData = @Html.Raw(Json.Encode(@ViewBag.getbarChartdata));
            if (barchartData != null) {
                $("#sparkline8").sparkline(barchartData, {
                    type: 'bar',
                    barWidth: 5,
                    height: '100px',
                    barColor: '#1e90ff',
                    negBarColor: '#1e90ff'
                });
            }
        });

    </script>
}